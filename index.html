<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cool WebQQ</title>
    <script src="lib/UUID.js"></script>

    <script src="extend/js/jquery-3.3.1.js"></script>
    <script src="extend/js/jquery-ui.js"></script>
    <script src="extend/js/jquery.cookie.js"></script>

    <link rel="stylesheet" href="extend/css/jquery-ui.theme.min.css">
    <link rel="stylesheet" href="extend/css/jquery-ui.min.css">
    <link rel="stylesheet" href="extend/css/jquery-ui.structure.min.css">
    <script src="lib/Connector.js"></script>
    <link rel="stylesheet" href="lib/webqq.css">
    <script src="lib/LoginDlg.js"></script>
    <script src="lib/RegisterDlg.js"></script>
    <script src="extend/js/jquery.validate.js"></script>
    <script src="lib/MyValidate.js"></script>
    <script src="lib/Chat.js"></script>

</head>

<script>
    var logindlg;
    var regisdlg;
    var chatdlg;
    var ses;
    $(document).ready(function () {
        onInitUI();
    });

    function onInitUI() {
        //检查用户是否登录
        Connector({
            data:{
                type:"USER_HAS_LOGIN",

            },
            success:function (json) {
                alert('已经登录');
                console.log(json);
                //返回好友列表
                onShowChatDialog(json);
            },
            failure:function (json) {
                onShowLoginDialog();
            }
        });
        onRegisterDialog();
        // ses = $.session.get('user');
        // if(ses){// show chat.js
        //     onShowChatDialog();
        // }else{
        //     onShowLoginDialog();
        // }

        new MyValidate();


    }

    function onShowChatDialog(json) {
        chatdlg = new ChatDlg({
            chatdiv: "chatdlg",
            friends: json.data,// friends list

        });
        chatdlg._dlg.dialog("open");
        // chatdlg._dlg.dialog("open");
    }

    function onRegisterDialog() {
        regisdlg = new RegisterDlg({
            regisdiv: "registerdlg"
        })

    }

    /**
     * show dialog
     */
    function onShowLoginDialog() {
        logindlg = new LoginDlg({
            logindiv: "logindlg",
        });
    }
</script>
<body>
<div id="logindlg" title="登录"></div>
<div id="registerdlg" title="注册"></div>
<div id="chatdlg"></div>
<div id="dlg_fail_msg" title="登录失败"></div>
</body>
</html>